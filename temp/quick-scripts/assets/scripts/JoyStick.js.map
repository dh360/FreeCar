{"version":3,"sources":["JoyStick.js"],"names":["cc","Class","extends","Component","properties","dot","default","type","Node","displayName","player","ring","onLoad","radius","width","center","getAnchorPoint","centerX","anchorX","centerY","anchorY","height","initListenerEvent","touchStartHandler","event","console","log","touchPos","node","convertToNodeSpaceAR","getLocation","figerPosition","distance","sub","getPosition","mag","_stickPos","setPosition","touchMoveHandler","posX","x","posY","y","p","v2","normalize","car","carPos","rotation","misc","radiansToDegrees","Math","atan2","newPos","position","add","mul","touchEndHandler","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","touchEndEvent","TOUCH_CANCEL"],"mappings":"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","file":"JoyStick.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        dot: { //圆点\n            default: null,\n            type: cc.Node,\n            displayName: 'DOT',\n\n        },\n        player: { //小车\n            default: null,\n            type: cc.Node,\n            displayName: 'player',\n        },\n        ring: { //圆圈\n            default: null,\n            type: cc.Node,\n            displayName: 'Ring'\n        }\n    },\n\n    onLoad() {\n        //挂载监听事件\n        // console.log('挂载 主场景');\n\n        this.radius = this.ring.width / 2; // 半径\n        let center = this.ring.getAnchorPoint(); //ring节点圆心\n        this.centerX = this.ring.anchorX * this.ring.width;\n        this.centerY = this.ring.anchorY * this.ring.height;\n        this.initListenerEvent();\n    },\n\n    //\n    touchStartHandler(event) {\n        console.log('开始触摸');\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n\n        let figerPosition = event.getLocation(); // 获取鼠标/手指触摸位置\n        // console.log('手指触摸位置', figerPosition);\n        const distance = touchPos.sub(this.ring.getPosition()).mag();\n        this._stickPos = this.ring.getPosition();\n\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n        }\n    },\n\n    touchMoveHandler(event) {\n        console.log('触摸过程中')\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        const distance = touchPos.mag();\n        const posX = this._stickPos.x + touchPos.x;\n        const posY = this._stickPos.y + touchPos.y;\n        // console.log(touchPos);\n        const p = cc.v2(posX, posY).sub(this.ring.getPosition()).normalize();\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n        } else {\n            const x = this._stickPos.x + p.x * this.radius;\n            const y = this._stickPos.y + p.y * this.radius;\n            this.dot.setPosition(cc.v2(x, y));\n\n        }\n        // console.log(p)\n\n        //移动车\n        const car = this.node;\n        let carPos = this.player.getPosition();\n        // car.setPosition(carPos.x + 1, carPos.y);\n        // console.log(carPos);\n        // car.rotation = carPos.x;\n        // car.rotationY = carPos.y;\n        // car.rotation = carPos.y / carPos.x;\n        this.player.rotation = 90 - cc.misc.radiansToDegrees(\n            Math.atan2(p.y, p.x)\n        );\n\n        let newPos = this.player.position.add(p.mul(3));\n        this.player.setPosition(newPos);\n    },\n\n    touchEndHandler(event) {\n        console.log('触摸结束')\n        // dot  归位\n        this.dot.setPosition(this.centerX, this.centerY);\n\n    },\n\n\n    initListenerEvent() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStartHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.touchEndEvent, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.touchEndEvent, this);\n    }\n});"]}