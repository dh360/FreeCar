{"version":3,"sources":["../../../../assets/scripts/assets/scripts/JoyStick.js"],"names":["cc","Class","extends","Component","properties","dot","default","type","Node","displayName","car","ring","onLoad","ringPos","getPosition","radius","width","centerX","anchorX","centerY","anchorY","height","initListenerEvent","touchStartHandler","event","touchPos","node","convertToNodeSpaceAR","getLocation","distance","sub","mag","_stickPos","setPosition","touchMoveHandler","posX","x","posY","y","p","v2","normalize","speedType","update","dt","stop","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL"],"mappings":"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","file":"JoyStick.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["import {\n    speedType\n} from './carSettings'\n\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        dot: { //操纵杆\n            default: null,\n            type: cc.Node,\n            displayName: 'DOT',\n\n        },\n        car: { //小车\n            default: null,\n            type: cc.Node,\n            displayName: 'Car',\n        },\n        ring: { //圆圈\n            default: null,\n            type: cc.Node,\n            displayName: 'Ring'\n        }\n    },\n\n    onLoad() {\n        //获取摇杆初始位置\n        this.ringPos = this.ring.getPosition();\n        this.radius = this.ring.width / 2; // 半径\n        this.centerX = this.ring.anchorX * this.ring.width;\n        this.centerY = this.ring.anchorY * this.ring.height;\n        this.initListenerEvent(); //挂载监听事件\n    },\n\n    //触摸开始处理事件\n    touchStartHandler(event) {\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        const distance = touchPos.sub(this.ring.getPosition()).mag();\n        this._stickPos = this.ring.getPosition();\n\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n        }\n    },\n\n    //手指移动处理事件\n    touchMoveHandler(event) {\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        const distance = touchPos.mag();\n        const posX = this._stickPos.x + touchPos.x;\n        const posY = this._stickPos.y + touchPos.y;\n        const p = cc.v2(posX, posY).sub(this.ring.getPosition()).normalize();\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n            this.car.speedType = 'NORMAL';\n        } else {\n            const x = this._stickPos.x + p.x * this.radius;\n            const y = this._stickPos.y + p.y * this.radius;\n            this.dot.setPosition(cc.v2(x, y));\n            this.car.speedType = 'FAST';\n        }\n    },\n\n    update(dt) {},\n\n    // 触摸结束\n    stop() {\n        //摇杆归位\n        this.dot.setPosition(this.ringPos);\n        this.car.speedType = 'STOP';\n    },\n\n    initListenerEvent() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStartHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.stop, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.stop, this);\n    }\n});"]}