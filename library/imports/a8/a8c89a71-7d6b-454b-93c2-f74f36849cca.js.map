{"version":3,"sources":["../../../../assets/scripts/assets/scripts/JoyStick.js"],"names":["cc","Class","extends","Component","properties","dot","default","type","Node","displayName","car","ring","onLoad","console","log","ringPos","getPosition","radius","width","centerX","anchorX","centerY","anchorY","height","initListenerEvent","getComponent","touchStartHandler","event","touchPos","node","convertToNodeSpaceAR","getLocation","distance","sub","mag","_stickPos","setPosition","touchMoveHandler","posX","x","posY","y","p","v2","normalize","moveDir","speedType","update","dt","stop","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL"],"mappings":"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","file":"JoyStick.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        dot: { //操纵杆\n            default: null,\n            type: cc.Node,\n            displayName: 'DOT',\n\n        },\n        car: { //小车\n            default: null,\n            type: cc.Node,\n            displayName: 'Car',\n        },\n        ring: { //圆圈\n            default: null,\n            type: cc.Node,\n            displayName: 'Ring'\n        }\n    },\n\n    onLoad() {\n        console.log('摇杆组件加载。。。')\n        //获取摇杆初始位置\n        this.ringPos = this.ring.getPosition();\n        console.log('控制杆的位置', this.ringPos);\n        this.radius = this.ring.width / 2; // 半径\n        this.centerX = this.ring.anchorX * this.ring.width;\n        this.centerY = this.ring.anchorY * this.ring.height;\n        this.initListenerEvent(); //挂载监听事件\n        this.car = this.car.getComponent('car');\n    },\n\n    //触摸开始处理事件\n    touchStartHandler(event) {\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        const distance = touchPos.sub(this.ring.getPosition()).mag();\n        this._stickPos = this.ring.getPosition();\n\n        console.log('触摸位置', touchPos);\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n        }\n    },\n\n    //手指移动处理事件\n    touchMoveHandler(event) {\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        const distance = touchPos.mag();\n        const posX = this._stickPos.x + touchPos.x;\n        const posY = this._stickPos.y + touchPos.y;\n        const p = cc.v2(posX, posY).sub(this.ring.getPosition()).normalize();\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n            this.car.moveDir = p;\n            this.car.speedType = 'NORMAL';\n        } else {\n            const x = this._stickPos.x + p.x * this.radius;\n            const y = this._stickPos.y + p.y * this.radius;\n            this.dot.setPosition(cc.v2(x, y));\n            this.car.moveDir = p;\n            this.car.speedType = 'FAST';\n        }\n    },\n\n    update(dt) {},\n\n    // 触摸结束\n    stop() {\n        //摇杆归位\n        this.dot.setPosition(this.ringPos);\n        this.car.speedType = 'STOP';\n    },\n\n    initListenerEvent() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStartHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.stop, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.stop, this);\n    }\n});"]}