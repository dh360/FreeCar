{"version":3,"sources":["../../../../assets/scripts/assets/scripts/JoyStick.js"],"names":["cc","Class","extends","Component","properties","dot","default","type","Node","displayName","player","ring","onLoad","ringPos","getPosition","radius","width","center","getAnchorPoint","centerX","anchorX","centerY","anchorY","height","initListenerEvent","touchStartHandler","event","console","log","touchPos","node","convertToNodeSpaceAR","getLocation","figerPosition","distance","sub","mag","_stickPos","setPosition","touchMoveHandler","posX","x","posY","y","p","v2","normalize","car","carPos","rotation","misc","radiansToDegrees","Math","atan2","newPos","position","add","mul","stop","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL"],"mappings":"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","file":"JoyStick.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        dot: { //操纵杆\n            default: null,\n            type: cc.Node,\n            displayName: 'DOT',\n\n        },\n        player: { //小车\n            default: null,\n            type: cc.Node,\n            displayName: 'player',\n        },\n        ring: { //圆圈\n            default: null,\n            type: cc.Node,\n            displayName: 'Ring'\n        }\n    },\n\n    onLoad() {\n        //获取摇杆初始位置\n\n        this.ringPos = this.ring.getPosition();\n        this.radius = this.ring.width / 2; // 半径\n        let center = this.ring.getAnchorPoint(); //ring节点圆心\n        this.centerX = this.ring.anchorX * this.ring.width;\n        this.centerY = this.ring.anchorY * this.ring.height;\n        //挂载监听事件\n        this.initListenerEvent();\n    },\n\n    touchStartHandler(event) {\n        console.log('开始');\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n\n        let figerPosition = event.getLocation(); // 获取鼠标/手指触摸位置\n        // console.log('手指触摸位置', figerPosition);\n        const distance = touchPos.sub(this.ring.getPosition()).mag();\n        this._stickPos = this.ring.getPosition();\n\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n        }\n    },\n\n    touchMoveHandler(event) {\n        console.log('手指移动');\n        const touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        const distance = touchPos.mag();\n        const posX = this._stickPos.x + touchPos.x;\n        const posY = this._stickPos.y + touchPos.y;\n        // console.log(touchPos);\n        const p = cc.v2(posX, posY).sub(this.ring.getPosition()).normalize();\n        if (distance <= this.radius) {\n            this.dot.setPosition(touchPos);\n        } else {\n            const x = this._stickPos.x + p.x * this.radius;\n            const y = this._stickPos.y + p.y * this.radius;\n            this.dot.setPosition(cc.v2(x, y));\n\n        }\n        //改变car角度 ， 改变位置\n        const car = this.node;\n        let carPos = this.player.getPosition();\n        this.player.rotation = 90 - cc.misc.radiansToDegrees(\n            Math.atan2(p.y, p.x)\n        );\n\n        let newPos = this.player.position.add(p.mul(3));\n        this.player.setPosition(newPos);\n    },\n\n\n    // 触摸结束\n    stop() {\n        //摇杆归位\n        console.log(this.ringPos)\n        this.dot.setPosition(this.ringPos);\n\n        //赛车停止移动\n        // let newPos = this.player.position.add(0);\n        this.player.setPosition(this.player.position);\n    },\n    initListenerEvent() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStartHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMoveHandler, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.stop, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.stop, this);\n    }\n});"]}